<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>To Do List (V0.0.1)</h1>
<button onclick="todoList(0)">未完成</button>
<button onclick="todoList(1)">已完成</button>
<button onclick="todoList(null)">查看所有</button>
<br>
<table id="table" style="text-align: center" border="1">

</table>


<script src="../js/jQuery/jquery-3.2.1.min.js"></script>
<script>
    $(function () {
        todoList(0);
    });


    function todoList(flag) {
        var show = $("#table");
        show.html("<tr>\n" +
            "        <td>标题</td>\n" +
            "        <td>开始时间</td>\n" +
            "        <td>结束时间</td>\n" +
            "        <td>备注</td>\n" +
            "        <td>是否完成</td>\n" +
            "        <td>修改</td>\n" +
            "    </tr>\n" +
            "    <tr>\n" +
            "        <td><input id='title' type='text'/></td>\n" +
            "        <td><input id='startTime' type='text'/></td>\n" +
            "        <td><input id='endTime' type='text'/></td>\n" +
            "        <td><input id='note' type='text'/></td>\n" +
            "        <td></td>\n" +
            "        <td>\n" +
            "            <button id='add' style='width:80px' onclick='addTask()'>新建</button>\n" +
            "        </td>\n" +
            "    </tr>");
        $.ajax({
            url: "http://120.79.12.253:8888/api/task",
            type: "get",
            contentType: "application/json;charset=utf-8",
            data: {"isDone": flag},
            datatype: "json",
            success: function (data) {
                var r = JSON.parse(data);
                for (var i = 0; i < r.length; i++) {
                    var val = r[i].id + "";
                    if (r[i].startTime == null) {
                        r[i].startTime = "";
                    }
                    if (r[i].endTime == null) {
                        r[i].endTime = "";
                    }
                    if (r[i].note == null) {
                        r[i].note = "";
                    }
                    if (r[i].isDone == undefined) {
                        r[i].isDone = "";
                    }
                    r[i].isDone = r[i].isDone == 1 ? "是" : "否";
                    show.append("<tr>");
                    show.append("<td>" + r[i].title + "</td>");
                    show.append("<td>" + r[i].startTime + "</td>");
                    show.append("<td>" + r[i].endTime + "</td>");
                    show.append("<td>" + r[i].note + "</td>");
                    show.append("<td>" + r[i].isDone + "</td>");
                    if (r[i].isDone == "是") {
                        show.append("<td>&nbsp;</td>");
                    }
                    else {
                        show.append("<td>" + "<button style='width: 80px' onclick='doneTask(" + r[i].id + ")'>完成</button>" + "</td>");
                    }
                    show.append("</tr>");
                }
            },
            error: function () {
                alert("获取失败");
            }
        });
    }

    function test(id) {
        alert(id);
    }

    function doneTask(id) {
        $.ajax({
            url: "http://120.79.12.253:8888/api/task",
            type: "put",
            async: false,
            contentType: "application/json;charset=utf-8",
            data: {"id": id, "isDone": 1},
            datatype: "json",
            success: function (data) {
                alert("更新成功");
                window.location.reload();
            },
            error: function () {
                console.log("error");
                alert("失败");
            },
            headers: {
                "Content-type": "application/x-www-form-urlencoded" //post put必须设置请求头 否则失败
            }
        });
    }


    function addTask() {
        var task = {
            "title": $("#title").val(),
            "startTime": $("#startTime").val(),
            "endTime": $("#endTime").val(),
            "note": $("#note").val()
        };
        $.ajax({
            url: "http://120.79.12.253:8888/api/task",
            type: "post",
            async: false,
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify(task),
            datatype: "json",
            success: function (data) {
                alert("添加成功");
                window.location.reload();
            },
            error: function () {
                alert("失败");
            }
        });
    }

    /*$("#add").click(function () {
        alert("hello");
    });

    function addClick() {
        console.log('dianjile');
    }

    var xx = document.querySelector("");
    child = js.table
    xx.appendChild(child)

    datasource = alsit;
    for (item in  alist) {

    }


    const tb = ( < table >
        {alist}
        < / table >
    )*/
</script>
</body>
</html>